### Порядок запуска модулей
<p id="start-list">Использовать следующую последовательность команд для корректного запуска:</p>

```bash
cd frontend-service
mvn clean install
mvn spring-boot:run

cd ../image-hosting
mvn clean install
mvn spring-boot:run

cd ../api-gateway
mvn clean install
mvn spring-boot:run
```
Главную страницу открывать по адресу:

```
 http://localhost:8090/index
```

## 1. Сборка проекта (Первый вариант)

```bash
  mvn clean install
```
```bash
  mvn spring-boot:run
```

## 2. Сборка проекта

Открыть консоль в корне проекта (где находится `pom.xml`) и выполнить:

```
./mvnw clean package
```

Или, если Maven установлен глобально:

```bash
  mvn clean package
```

После этого в папке `target/` появится `.jar`-файл, например:

```
target/diploma-2-0-0.0.1-SNAPSHOT.jar
```

## 3. Запуск приложения

Чтобы запустить приложение, выполнить команду:

```bash
java -jar target/diploma-2-0-0.0.1-SNAPSHOT.jar
```

Если менялось имя JAR-файла или `artifactId`, нужно скорректировать имя файла для команды запуска.

## 4. Запуск тестов
Запускать тесты можно как обычные тесты в JUnit, например, используя IDE или команду Maven:

```bash
  mvn test
```
или 
```bash
  mvn clean test
```
- **Примечание**:
Чтобы протестировать класс ImageController, который использует сервис ImageService и работает с файлами, нужно замокать сервис и проверить каждый 
метод контроллера с использованием фреймворка тестирования Spring.
Чтобы замокать зависимости, использовать MockMvc для тестирования HTTP-запросов и аннотации из Spring, например, @MockBean.

## SQL-запросы для создания базы данных PostgreSQL

Создание базы данных и таблиц в PostgreSQL:

```
-- Создать базу данных
CREATE
DATABASE images_db;


-- Создать таблицу users
CREATE TABLE users
(
    id       SERIAL PRIMARY KEY,
    login    VARCHAR(50)  NOT NULL UNIQUE,
    password VARCHAR(100) NOT NULL    
);

-- Создать таблицу item
CREATE TABLE item
(
    id          SERIAL PRIMARY KEY,
    name        VARCHAR(100) NOT NULL,
    description TEXT,
    link        VARCHAR(200)
);

```

Добавление значений в Таблицу 'users'

```
INSERT INTO users (login, password)
VALUES ('admin', '$2a$12$LbAPCsHn8ZN5MUDqDmIX7e9n1YlDkCxEt0lW3Q2WuW0M1vteo8jvG'), -- пароль зашифрован
       ('user', '$2a$12$.dlnBAYq6sOUumn3jtG.AepxdSwGxJ8xA2iAPoCHSH61Vjl.JbIfq') -- пароль зашифрован


```

#### Страница авторизации

Это страница, на которой пользователи могут ввести свои логин и пароль для входа в систему:<br>
my-app.html

## Главная страница (index.html):

### URL: http://localhost:8090/

<br><br>



### Как использовать профиль run-all

Профиль run-all указывает Maven собирать и запускать три модуля: api-gateway, frontend-service и image-hosting.

`<id>run-all</id>` - это имя профиля в данном случае он называется run-all, и его можно использовать для активации данного профиля в командной строке.

`<modules>`- внутри профиля указаны модули, которые должны быть собраны в рамках этого профиля.

Для того чтобы запустить этот профиль и собрать все модули, нужно выполнить команду:
Эта команда активирует профиль run-all и соберет все три модуля в одном процессе.

```bash
  mvn clean install -Prun-all
```
#### Настройка для разных сред 
Можно добавить дополнительные настройки для различных окружений, например, для разработки или продакшн. 
Например, добавить настройки для конфигурации базы данных или логирования, которые могут отличаться в разных средах.

#### Использование команд для отдельных сервисов 
Если нужно собирать только один модуль, можно использовать команду без указания профиля для сборки только одного модуля.
- Эта команда соберет только модуль api-gateway:
```bash
  mvn clean install -pl api-gateway
```
- Эта команда соберет только модуль frontend-service:
```bash
  mvn clean install -pl frontend-service
```
- Эта команда соберет только модуль image-hosting:
```bash
  mvn clean install -pl image-hosting
```

Чтобы собрать все модули, указанные в профили, использовать команду:
```bash 
  mvn clean install -Prun-all
```
### Тестирование

MockMvc - используется для имитации HTTP-запросов к контроллеру и проверки его ответов. Он позволяет протестировать обработку различных запросов без реальной загрузки и отправки HTTP-запросов.
@MockBean - позволяет мокировать зависимости, такие как сервисы, чтобы изолировать контроллер и не зависеть от реальной реализации сервиса. В данном случае мы мокируем ImageService.
Mockito - используется для создания мок-объектов (например, файлов или сервисов), а также для проверки их взаимодействий с контроллером.
@RequestParam и @PathVariable - используются для передачи параметров в методы контроллера. В тестах передаются параметры как для URL, так и для формы (например, при отправке файла).
Redirect и редиректы - тестируем редиректы на страницу галереи после загрузки или удаления изображения.
Повторная проверка - мы проверяем, что правильные методы сервиса вызываются правильное количество раз (с использованием verify()).


Тесты можно запустить через команду:

```bash
  mvn test
```

#### Проверка полного стека ошибок

Чтобы понять, в чём именно проблема, использоватьь подробный вывод ошибок, добавив флаг -e или -X при запуске Maven:

- Для подробного лога:

```bash
  mvn spring-boot:run -e
```
- Для полного вывода отладки:

```bash
  mvn spring-boot:run -X
```
##
### Список сервисов с возвращаемыми данными
1. **Gateway** - маршрутизирует HTML запросы к frontend, API - к image-hosting.
2. **frontend-service** - возвращает только HTML-шаблоны, все `@Controller` и `return "index"`, и т.д.
3. **image-hosting** - только API (JSON, файлы, данные), никаких возвращений шаблонов.


### Текущий запуск сервисов
Сервисы работают на портах:

1. port **8090** - gateway
2. port **8082** - frontend-service
3. port **8084** - image-hosting

##
### Доступные ссылки и маршруты:

1. **[http://localhost:8090/index](http://localhost:8090/index)**

    * **Назначение:** Главная страница приложения, вывод через шаблон index.html модуля frontend-service.
    * **Вывод через браузер:** HTML-шаблон index.html.
    * **Дополнительная информация:** Ммаршруты запускаются в модуле frontend-service на порту 8082.

2. **[http://localhost:8090/email-page](http://localhost:8090/email-page)**

    * **Назначение:** Страница отправки email-сообщений (шаблон из frontend-service).
    * **Вывод через браузер:** HTML-шаблон email-page.html.
    * **Дополнительная информация:** В модуле frontend-service, в шаблонах `templates`.

3. **[http://localhost:8090/oops](http://localhost:8090/oops)**

    * **Назначение:** Универсальная страница ошибок.
    * **Вывод через браузер:** HTML-шаблон oops.html.
    * **Дополнительная информация:** В модуле frontend-service, в шаблонах `templates`.

4. **[http://localhost:8090/edit-item](http://localhost:8090/edit-item)**

    * **Назначение:** Страница редактирования элемента (если используется).
    * **Вывод через браузер:** HTML-шаблон edit-item.html.
    * **Дополнительная информация:** В модуле frontend-service, в шаблонах `templates`.

5. **[http://localhost:8090/api/images/](http://localhost:8090/api/images/)**

    * **Назначение:** REST API микросервиса image-hosting.
    * **Вывод через браузер:** JSON-ответы, доступ через REST-клиенты.
    * **Дополнительная информация:** Сервис image-hosting запускается на порту 8084, с маршрутами через api-gateway.

6. **[http://localhost:8082](http://localhost:8082)**

    * **Назначение:** Прямой доступ к frontend-service (не рекомендуется использовать напрямую, только через gateway).
    * **Вывод через браузер:** HTML-шаблоны.
    * **Дополнительная информация:** В модуле frontend-service, в шаблонах `templates`.

7. **[http://localhost:8084](http://localhost:8084)**

    * **Назначение:** Прямой доступ к image-hosting API.
    * **Вывод через браузер:** JSON-данные.
    * **Дополнительная информация:** Выполняется в контроллерах с конфигурациями REST.

#### Проверка работоспособности

- Последовательность проверки:

  - Запустить все сервисы в указанном порядке.
  - Открыть ссылку [http://localhost:8090/index](http://localhost:8090/index).
  - Последовательно проверить другие страницы и API-методы [по ссылкам, указанным в п." Порядок запуска модулей"](#start-list).

<br><br><br><br>
